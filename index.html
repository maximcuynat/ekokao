<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EKOKAO - Gestionnaire de Partie</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
        }

        .game-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            background-color: white;
        }

        .game-card:hover {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .weather-card {
            background-color: #f8d7da;
        }

        .habitation-card {
            background-color: #d4edda;
        }

        .protection-card {
            background-color: #cce5ff;
        }

        .deck-info {
            text-align: center;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <!-- Barre de Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-globe"></i> EKOKAO
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="modal" data-bs-target="#settingsModal">
                <i class="bi bi-gear-fill"></i>
            </button>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="row">
            <!-- Panneau de Contrôle -->
            <div class="col-md-3">
                <!-- Timer et État du Jeu -->
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-clock"></i> Contrôle de Partie</h5>
                    </div>
                    <div class="card-body">
                        <!-- Timer -->
                        <div class="timer-display" id="timer">03:00</div>
                        <div class="d-flex justify-content-center gap-2 mb-3">
                            <button class="btn btn-success" id="startTimer">
                                <i class="bi bi-play-fill"></i>
                            </button>
                            <button class="btn btn-warning" id="pauseTimer">
                                <i class="bi bi-pause-fill"></i>
                            </button>
                            <button class="btn btn-danger" id="resetTimer">
                                <i class="bi bi-arrow-counterclockwise"></i>
                            </button>
                        </div>

                        <!-- État de la partie -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Mois:</span>
                                <span id="currentMonth" class="badge bg-primary">1/12</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Tour:</span>
                                <span id="currentTurn" class="badge bg-primary">1/24</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Équipe Active:</span>
                                <span id="activeTeam" class="badge bg-success">Météo</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Continent Actif:</span>
                                <span id="activeContinent" class="badge bg-info">Europe</span>
                            </div>
                        </div>

                        <!-- Contrôles de jeu -->
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="nextTurn">
                                <i class="bi bi-arrow-right-circle"></i> Tour Suivant
                            </button>
                            <button class="btn btn-success" id="saveGame">
                                <i class="bi bi-save"></i> Sauvegarder
                            </button>
                            <button class="btn btn-warning" id="loadGame">
                                <i class="bi bi-folder-open"></i> Charger
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Historique -->
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="bi bi-clock-history"></i> Historique</h5>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="actionHistory"></ul>
                    </div>
                </div>
            </div>

            <!-- Zone de Jeu Principale -->
            <div class="col-md-9">
                <!-- Sélection des Continents -->
                <div class="card mb-3">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Continents</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="continentButtons">
                            <div class="col-md-2 mb-2">
                                <button class="btn btn-outline-primary w-100" data-continent="Europe">Europe</button>
                            </div>
                            <div class="col-md-2 mb-2">
                                <button class="btn btn-outline-primary w-100" data-continent="Afrique">Afrique</button>
                            </div>
                            <div class="col-md-2 mb-2">
                                <button class="btn btn-outline-primary w-100" data-continent="Asie">Asie</button>
                            </div>
                            <div class="col-md-2 mb-2">
                                <button class="btn btn-outline-primary w-100" data-continent="Océanie">Océanie</button>
                            </div>
                            <div class="col-md-2 mb-2">
                                <button class="btn btn-outline-primary w-100" data-continent="Amérique du Nord">Am.
                                    Nord</button>
                            </div>
                            <div class="col-md-2 mb-2">
                                <button class="btn btn-outline-primary w-100" data-continent="Amérique du Sud">Am.
                                    Sud</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Zone de Jeu Active -->
                <div class="row">
                    <!-- Cartes Habitation -->
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-house"></i> Habitations
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="deck-info">
                                    <button class="btn btn-primary" id="drawHabitationBtn">
                                        <i class="bi bi-plus-circle"></i> Tirer une carte habitation
                                    </button>
                                    <div class="mt-2" id="deckStatus"></div>
                                </div>
                                <div id="availableCards"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Cartes Météo -->
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-cloud-lightning"></i> Météo
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="weatherCards"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal des Paramètres -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-gear"></i> Paramètres
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Profils -->
                    <h6>Profils</h6>
                    <div class="mb-3">
                        <select class="form-select mb-2" id="profileSelect">
                            <option value="">Sélectionner un profil</option>
                        </select>
                        <div class="btn-group">
                            <button class="btn btn-primary" id="newProfileBtn">
                                <i class="bi bi-plus-circle"></i> Nouveau
                            </button>
                            <button class="btn btn-danger" id="deleteProfileBtn">
                                <i class="bi bi-trash"></i> Supprimer
                            </button>
                        </div>
                    </div>

                    <!-- Paramètres de Difficulté -->
                    <h6>Difficulté</h6>
                    <div class="mb-3">
                        <select class="form-select" id="difficultyLevel">
                            <option value="easy">Facile</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Difficile</option>
                        </select>
                    </div>

                    <!-- Paramètres Météo -->
                    <h6>Paramètres Météo</h6>
                    <div id="weatherSettings"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveSettings">Sauvegarder</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal d'Action -->
    <div class="modal fade" id="actionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="confirmAction">Confirmer</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>

<!-- Datas -->
<script>
    // gameData.js

    const gameData = {
        // Configuration du jeu
        gameConfig: {
            maxMonths: 12,
            maxTurns: 24,
            turnDuration: 180, // 3 minutes en secondes
            minPlayers: 3,
            maxPlayers: 5
        },

        // Configuration des continents et leurs catastrophes/habitations
        continents: {
            "Europe": {
                catastrophes: [
                    {
                        name: "Inondation Européenne",
                        basePower: 1,
                        maxPower: 4,
                        description: "Les inondations affectent fréquemment les régions d'Europe centrale et de l'Ouest, particulièrement le long du Rhin, du Danube et de la Seine."
                    },
                    {
                        name: "Tempête Hivernale Nord-Européenne",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les tempêtes hivernales, avec leurs vents violents et leurs chutes de neige, frappent souvent les pays nordiques et d'Europe de l'Ouest."
                    },
                    {
                        name: "Vague de Chaleur Méditerranéenne",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les vagues de chaleur touchent particulièrement les pays méditerranéens comme l'Espagne, l'Italie et la Grèce."
                    },
                    {
                        name: "Éruption Volcanique Islandaise",
                        basePower: 1,
                        maxPower: 5,
                        description: "Les volcans en Islande peuvent provoquer des éruptions qui affectent non seulement l'île mais aussi le reste de l'Europe."
                    },
                    {
                        name: "Séisme Méditerranéen",
                        basePower: 1,
                        maxPower: 4,
                        description: "Des pays comme la Grèce, l'Italie et la Turquie sont situés sur des zones sismiques actives."
                    },
                    {
                        name: "Incendie de Forêt en Europe du Sud",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les incendies de forêt, fréquents en été dans le sud de l'Europe."
                    },
                    {
                        name: "Crue Subite des Alpes",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les régions alpines subissent des crues soudaines provoquées par la fonte rapide des neiges."
                    }
                ],
                habitations: [
                    {
                        name: "Maison de Village (France)",
                        resistance: 1,
                        description: "Construction rurale traditionnelle, vulnérable aux inondations."
                    },
                    {
                        name: "Chalet Alpin (Suisse)",
                        resistance: 1,
                        description: "Habitation en montagne, fragile face aux avalanches et séismes."
                    },
                    {
                        name: "Maison Côtière (Pays-Bas)",
                        resistance: 1,
                        description: "Maison au bord de l'eau, sensible aux inondations."
                    },
                    {
                        name: "Maison en Pierre (Italie)",
                        resistance: 1,
                        description: "Habitation traditionnelle, fragile aux séismes et vagues de chaleur."
                    },
                    {
                        name: "Appartement Urbain (Allemagne)",
                        resistance: 1,
                        description: "Immeuble urbain, exposé aux tempêtes et vagues de chaleur."
                    }
                ]
            },
            "Afrique": {
                catastrophes: [
                    {
                        name: "Sécheresse Sahélienne",
                        basePower: 1,
                        maxPower: 5,
                        description: "La sécheresse au Sahel est exacerbée par le changement climatique et la déforestation."
                    },
                    {
                        name: "Inondation Tropicale",
                        basePower: 1,
                        maxPower: 4,
                        description: "Les inondations tropicales frappent souvent les régions riveraines et côtières d'Afrique de l'Ouest."
                    },
                    {
                        name: "Tempête de Sable Saharienne",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les tempêtes de sable du Sahara transportent des particules fines sur des milliers de kilomètres."
                    },
                    {
                        name: "Invasion de Criquets Pèlerins",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les invasions de criquets pèlerins dévastent les cultures dans la Corne de l'Afrique."
                    },
                    {
                        name: "Séisme de la Vallée du Rift",
                        basePower: 1,
                        maxPower: 4,
                        description: "La Vallée du Rift est sujette à une activité sismique modérée."
                    },
                    {
                        name: "Feu de Brousse en Afrique Australe",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les feux de brousse en Afrique australe touchent des pays comme l'Afrique du Sud."
                    },
                    {
                        name: "Cyclone du Canal du Mozambique",
                        basePower: 1,
                        maxPower: 5,
                        description: "Les cyclones frappent durement les régions côtières de Madagascar et du Mozambique."
                    }
                ],
                habitations: [
                    {
                        name: "Case en Terre Battue (Sahara)",
                        resistance: 1,
                        description: "Structure simple en zone désertique, vulnérable aux tempêtes de sable."
                    },
                    {
                        name: "Maison en Bois (Côte d'Ivoire)",
                        resistance: 1,
                        description: "Construction rurale, exposée aux invasions de criquets et inondations."
                    },
                    {
                        name: "Habitation sur Pilotes (Nigeria)",
                        resistance: 1,
                        description: "Habitation côtière, sensible aux inondations et marées."
                    },
                    {
                        name: "Maison Urbaine (Kenya)",
                        resistance: 1,
                        description: "Immeuble dans une grande ville, exposé aux séismes et sécheresses."
                    },
                    {
                        name: "Ferme Rurale (Afrique du Sud)",
                        resistance: 1,
                        description: "Maison rurale, vulnérable à la sécheresse et aux incendies de brousse."
                    }
                ]
            },
            "Asie": {
                catastrophes: [
                    {
                        name: "Typhon Asiatique",
                        basePower: 1,
                        maxPower: 5,
                        description: "Les typhons affectent principalement les côtes de l'Asie de l'Est et du Sud-Est."
                    },
                    {
                        name: "Séisme d'Himalaya",
                        basePower: 1,
                        maxPower: 5,
                        description: "La région himalayenne est sismiquement active en raison de la collision des plaques tectoniques."
                    },
                    {
                        name: "Tsunami Pacifique",
                        basePower: 1,
                        maxPower: 5,
                        description: "Suite à des séismes sous-marins, les tsunamis déferlent sur les côtes du Pacifique."
                    },
                    {
                        name: "Inondation de Mousson",
                        basePower: 1,
                        maxPower: 4,
                        description: "La saison de la mousson apporte des pluies torrentielles."
                    },
                    {
                        name: "Éruption Volcanique Indonésienne",
                        basePower: 1,
                        maxPower: 5,
                        description: "L'Indonésie se trouve sur la 'ceinture de feu' du Pacifique."
                    },
                    {
                        name: "Tempête de Sable Asiatique",
                        basePower: 1,
                        maxPower: 3,
                        description: "La désertification exacerbe les tempêtes de sable en Asie centrale."
                    },
                    {
                        name: "Smog Industriel",
                        basePower: 1,
                        maxPower: 2,
                        description: "La pollution atmosphérique dans les villes d'Asie atteint des niveaux critiques."
                    }
                ],
                habitations: [
                    {
                        name: "Maison de Paille (Bangladesh)",
                        resistance: 1,
                        description: "Habitation simple en plaine, très exposée aux inondations et moussons."
                    },
                    {
                        name: "Maison de Village (Inde)",
                        resistance: 1,
                        description: "Structure en briques non renforcées, fragile face aux typhons."
                    },
                    {
                        name: "Appartement Urbain (Japon)",
                        resistance: 1,
                        description: "Immeuble en zone sismique, exposé aux séismes et tsunamis."
                    },
                    {
                        name: "Maison en Bois (Indonésie)",
                        resistance: 1,
                        description: "Habitation rurale, vulnérable aux éruptions volcaniques et séismes."
                    },
                    {
                        name: "Yourte (Mongolie)",
                        resistance: 1,
                        description: "Habitation mobile, sensible aux vents violents et températures extrêmes."
                    }
                ]
            },
            "Océanie": {
                catastrophes: [
                    {
                        name: "Cyclone du Pacifique Sud",
                        basePower: 1,
                        maxPower: 4,
                        description: "Les îles du Pacifique sont régulièrement touchées par de puissants cyclones."
                    },
                    {
                        name: "Feu de Brousse Australien",
                        basePower: 1,
                        maxPower: 4,
                        description: "En Australie, les incendies de brousse se produisent fréquemment en période de sécheresse."
                    },
                    {
                        name: "Séisme en Nouvelle-Zélande",
                        basePower: 1,
                        maxPower: 5,
                        description: "La Nouvelle-Zélande est sujette aux tremblements de terre majeurs."
                    },
                    {
                        name: "Blanchissement des Coraux",
                        basePower: 1,
                        maxPower: 3,
                        description: "Le réchauffement des océans menace la Grande Barrière de corail."
                    },
                    {
                        name: "Tempête de Sable du Désert Australien",
                        basePower: 1,
                        maxPower: 2,
                        description: "Les tempêtes de sable sont fréquentes dans les régions arides de l'Australie."
                    },
                    {
                        name: "Inondation Tropicale des Îles Fidji",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les îles Fidji sont vulnérables aux inondations causées par les fortes pluies."
                    },
                    {
                        name: "Éruption Volcanique de Vanuatu",
                        basePower: 1,
                        maxPower: 4,
                        description: "Les volcans actifs de Vanuatu présentent un risque constant d'éruptions."
                    }
                ],
                habitations: [
                    {
                        name: "Maison en Bois (Australie)",
                        resistance: 1,
                        description: "Construction classique, vulnérable aux incendies de brousse."
                    },
                    {
                        name: "Cabane Tropicale (Nouvelle-Calédonie)",
                        resistance: 1,
                        description: "Habitation en zone humide, fragile face aux cyclones."
                    },
                    {
                        name: "Maison sur Piloti (Îles Fidji)",
                        resistance: 1,
                        description: "Structure côtière, sensible aux cyclones et tsunamis."
                    },
                    {
                        name: "Ferme Isolée (Nouvelle-Zélande)",
                        resistance: 1,
                        description: "Maison rurale exposée aux séismes."
                    },
                    {
                        name: "Maison Préfabriquée (Australie)",
                        resistance: 1,
                        description: "Habitation légère, fragile face aux tempêtes et incendies."
                    }
                ]
            },
            "Amérique du Nord": {
                catastrophes: [
                    {
                        name: "Ouragan Atlantique",
                        basePower: 1,
                        maxPower: 5,
                        description: "Les ouragans de l'Atlantique touchent durement les côtes de la Floride et du Texas."
                    },
                    {
                        name: "Tornade du Midwest",
                        basePower: 1,
                        maxPower: 4,
                        description: "Le 'Tornado Alley' est célèbre pour ses violentes tornades."
                    },
                    {
                        name: "Incendie de Forêt de Californie",
                        basePower: 1,
                        maxPower: 4,
                        description: "Les incendies de forêt en Californie se propagent rapidement."
                    },
                    {
                        name: "Séisme de San Andreas",
                        basePower: 1,
                        maxPower: 5,
                        description: "La faille de San Andreas est une zone sismique majeure."
                    },
                    {
                        name: "Inondation du Mississippi",
                        basePower: 1,
                        maxPower: 4,
                        description: "Le fleuve Mississippi est sujet à des inondations importantes."
                    },
                    {
                        name: "Tempête de Neige du Nord-Est",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les tempêtes de neige paralysent régulièrement les villes du Nord-Est."
                    },
                    {
                        name: "Éruption du Mont Saint Helens",
                        basePower: 1,
                        maxPower: 5,
                        description: "Le Mont Saint Helens peut provoquer des éruptions explosives, entraînant des nuages de cendres et des coulées de boue."
                    }
                ],
                habitations: [
                    {
                        name: "Cabane en Bois (Canada)",
                        resistance: 1,
                        description: "Petite habitation forestière, vulnérable aux incendies et tempêtes."
                    },
                    {
                        name: "Maison Suburbaine (États-Unis)",
                        resistance: 1,
                        description: "Habitation typique des banlieues, fragile face aux tornades."
                    },
                    {
                        name: "Bungalow Côtier (Floride)",
                        resistance: 1,
                        description: "Habitation en zone de plage, fortement exposée aux ouragans."
                    },
                    {
                        name: "Ferme Isolée (Midwest)",
                        resistance: 1,
                        description: "Maison rurale avec dépendances, vulnérable aux vents et orages."
                    },
                    {
                        name: "Chalet Montagnard (Rockies)",
                        resistance: 1,
                        description: "Résidence de montagne, exposée aux glissements de terrain et séismes."
                    }
                ]
            },
            "Amérique du Sud": {
                catastrophes: [
                    {
                        name: "Inondation de l'Amazone",
                        basePower: 1,
                        maxPower: 4,
                        description: "L'Amazonie subit régulièrement des inondations massives lors de la saison des pluies."
                    },
                    {
                        name: "Séisme de la Cordillère des Andes",
                        basePower: 1,
                        maxPower: 5,
                        description: "La chaîne andine est sujette à de forts séismes en raison des plaques tectoniques actives."
                    },
                    {
                        name: "Éruption Volcanique Andine",
                        basePower: 1,
                        maxPower: 4,
                        description: "Les volcans andins présentent des risques d'éruptions explosives et de coulées de lave."
                    },
                    {
                        name: "Glissement de Terrain Andin",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les régions montagneuses sont souvent sujettes aux glissements de terrain en période de fortes pluies."
                    },
                    {
                        name: "Tempête Tropicale Atlantique",
                        basePower: 1,
                        maxPower: 3,
                        description: "Les côtes nord-est sont exposées à des tempêtes tropicales provoquant des vents violents."
                    },
                    {
                        name: "Sécheresse du Nordeste Brésilien",
                        basePower: 1,
                        maxPower: 3,
                        description: "Le Nordeste du Brésil est régulièrement frappé par des sécheresses prolongées."
                    },
                    {
                        name: "Invasion de Criquets des Pampas",
                        basePower: 1,
                        maxPower: 2,
                        description: "Les criquets peuvent envahir les vastes étendues agricoles de l'Argentine et de l'Uruguay."
                    }
                ],
                habitations: [
                    {
                        name: "Maison sur Pilotes (Amazone)",
                        resistance: 1,
                        description: "Structure surélevée pour les zones humides, sensible aux inondations."
                    },
                    {
                        name: "Cabane Andine (Pérou)",
                        resistance: 1,
                        description: "Maison simple en montagne, vulnérable aux séismes."
                    },
                    {
                        name: "Habitat de Favela (Brésil)",
                        resistance: 1,
                        description: "Structure urbaine dense, fragile face aux glissements de terrain et inondations."
                    },
                    {
                        name: "Maison en Adobe (Colombie)",
                        resistance: 1,
                        description: "Construction en terre crue, peu résistante aux séismes."
                    },
                    {
                        name: "Ranch Tropical (Venezuela)",
                        resistance: 1,
                        description: "Maison en zone rurale tropicale, exposée aux tempêtes et criquets."
                    }
                ]
            }
        },

        // Section des améliorations et protections
        improvements: {
            foundations: [
                {
                    name: "Fondations Renforcées",
                    effect: "+1 Résistance",
                    description: "Protège mieux contre les séismes et glissements de terrain"
                },
                {
                    name: "Matériaux Ignifugés",
                    effect: "+1 Résistance",
                    description: "Réduit les dégâts d'incendie et de chaleur"
                },
                {
                    name: "Isolation Contre les Inondations",
                    effect: "+2 Résistance",
                    description: "Utile contre les inondations et tsunamis"
                },
                {
                    name: "Barrière Anti-Vent",
                    effect: "+1 Résistance",
                    description: "Protège contre les tempêtes et ouragans"
                },
                {
                    name: "Revêtement Anti-Insectes",
                    effect: "+1 Résistance",
                    description: "Réduit les dégâts d'invasions de criquets"
                }
            ],
            protections: {
                global: [
                    {
                        name: "Déversoir d'Orage",
                        effect: "Réduit la puissance de l'inondation de 2 points",
                        description: "Un système de déversoirs et de digues pour diriger l'eau"
                    },
                    {
                        name: "Système de Ventilation Thermique",
                        effect: "Diminue la puissance de la vague de chaleur de 2 points",
                        description: "Système de refroidissement avancé"
                    },
                    {
                        name: "Paratonnerres Renforcés",
                        effect: "Réduit de 1 point les dégâts des tempêtes et orages",
                        description: "Installation de paratonnerres et câbles conducteurs"
                    },
                    {
                        name: "Équipements Antisismiques",
                        effect: "Réduit la puissance des séismes de 2 points",
                        description: "Renforcement structurel des habitations"
                    }
                ]
            }
        }
    };
</script>

<!-- Setting -->
<script>
    // settingsManager.js

    class SettingsManager {
        constructor() {
            this.currentProfile = null;
            this.profiles = {};
            this.defaultSettings = {
                weatherConfig: {
                    baseIntensity: 1,
                    maxIntensity: 5,
                    progressionRate: 0.2,
                    events: {
                        tornado: { enabled: true, basePower: 1, maxPower: 4 },
                        flood: { enabled: true, basePower: 1, maxPower: 3 },
                        earthquake: { enabled: true, basePower: 1, maxPower: 5 },
                        drought: { enabled: true, basePower: 1, maxPower: 3 },
                        hurricane: { enabled: true, basePower: 1, maxPower: 5 }
                    }
                },
                difficulty: {
                    level: 'normal',
                    progression: 3
                }
            };

            this.initializeSettings();
            this.setupEventListeners();
        }

        initializeSettings() {
            // Charger les profils sauvegardés
            const savedProfiles = localStorage.getItem('ekokaoprofiles');
            if (savedProfiles) {
                this.profiles = JSON.parse(savedProfiles);
            }

            // Mise à jour de la liste des profils
            this.updateProfileList();
        }

        setupEventListeners() {
            // Gestion des profils
            document.getElementById('profileSelect').addEventListener('change', (e) => {
                this.loadProfile(e.target.value);
            });

            document.getElementById('newProfileBtn').addEventListener('click', () => {
                this.createNewProfile();
            });

            document.getElementById('deleteProfileBtn').addEventListener('click', () => {
                this.deleteCurrentProfile();
            });

            document.getElementById('saveSettings').addEventListener('click', () => {
                this.saveCurrentSettings();
            });
        }

        // Création d'un nouveau profil
        createNewProfile() {
            const profileName = prompt('Nom du nouveau profil:');
            if (profileName && !this.profiles[profileName]) {
                this.profiles[profileName] = JSON.parse(JSON.stringify(this.defaultSettings));
                this.saveProfiles();
                this.updateProfileList();
                this.loadProfile(profileName);
            }
        }

        // Chargement d'un profil
        loadProfile(profileName) {
            if (this.profiles[profileName]) {
                this.currentProfile = profileName;
                this.updateSettingsDisplay(this.profiles[profileName]);
            }
        }

        // Suppression du profil actuel
        deleteCurrentProfile() {
            if (this.currentProfile && confirm(`Supprimer le profil ${this.currentProfile} ?`)) {
                delete this.profiles[this.currentProfile];
                this.saveProfiles();
                this.updateProfileList();
                this.currentProfile = null;
            }
        }

        // Mise à jour de l'affichage des paramètres
        updateSettingsDisplay(settings) {
            const weatherSettings = document.getElementById('weatherSettings');
            weatherSettings.innerHTML = '';

            // Paramètres météo généraux
            weatherSettings.innerHTML += `
            <div class="col-md-4 mb-3">
                <label class="form-label">Intensité de base</label>
                <input type="number" class="form-control" id="baseIntensity" 
                       value="${settings.weatherConfig.baseIntensity}" min="1" max="5">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Intensité maximale</label>
                <input type="number" class="form-control" id="maxIntensity" 
                       value="${settings.weatherConfig.maxIntensity}" min="1" max="10">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Taux de progression</label>
                <input type="number" class="form-control" id="progressionRate" 
                       value="${settings.weatherConfig.progressionRate}" step="0.1" min="0" max="1">
            </div>
        `;

            // Paramètres des événements météo
            Object.entries(settings.weatherConfig.events).forEach(([event, config]) => {
                weatherSettings.innerHTML += `
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h6>${this.capitalizeFirstLetter(event)}</h6>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" 
                                       id="${event}Enabled" ${config.enabled ? 'checked' : ''}>
                                <label class="form-check-label">Activé</label>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Puissance de base</label>
                                <input type="number" class="form-control" 
                                       id="${event}BasePower" value="${config.basePower}" 
                                       min="1" max="5">
                            </div>
                            <div>
                                <label class="form-label">Puissance maximale</label>
                                <input type="number" class="form-control" 
                                       id="${event}MaxPower" value="${config.maxPower}" 
                                       min="1" max="10">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            });

            // Mise à jour des paramètres de difficulté
            document.getElementById('difficultyLevel').value = settings.difficulty.level;
            document.getElementById('difficultyProgression').value = settings.difficulty.progression;
        }

        // Sauvegarde des paramètres actuels
        saveCurrentSettings() {
            if (!this.currentProfile) return;

            const settings = {
                weatherConfig: {
                    baseIntensity: parseInt(document.getElementById('baseIntensity').value),
                    maxIntensity: parseInt(document.getElementById('maxIntensity').value),
                    progressionRate: parseFloat(document.getElementById('progressionRate').value),
                    events: {}
                },
                difficulty: {
                    level: document.getElementById('difficultyLevel').value,
                    progression: parseInt(document.getElementById('difficultyProgression').value)
                }
            };

            // Sauvegarde des paramètres des événements météo
            Object.keys(this.defaultSettings.weatherConfig.events).forEach(event => {
                settings.weatherConfig.events[event] = {
                    enabled: document.getElementById(`${event}Enabled`).checked,
                    basePower: parseInt(document.getElementById(`${event}BasePower`).value),
                    maxPower: parseInt(document.getElementById(`${event}MaxPower`).value)
                };
            });

            this.profiles[this.currentProfile] = settings;
            this.saveProfiles();
        }

        // Mise à jour de la liste des profils
        updateProfileList() {
            const select = document.getElementById('profileSelect');
            select.innerHTML = '<option value="">Sélectionner un profil</option>';

            Object.keys(this.profiles).forEach(profileName => {
                const option = document.createElement('option');
                option.value = profileName;
                option.textContent = profileName;
                if (profileName === this.currentProfile) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        // Sauvegarde des profils dans le localStorage
        saveProfiles() {
            localStorage.setItem('ekokaoprofiles', JSON.stringify(this.profiles));
        }

        // Utilitaires
        capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Obtenir les paramètres actuels
        getCurrentSettings() {
            return this.currentProfile ?
                this.profiles[this.currentProfile] :
                JSON.parse(JSON.stringify(this.defaultSettings));
        }
    }

</script>

<!-- Logic -->
<script>
    class HabitationDeckManager {
        constructor(gameData) {
            console.log('Initialisation du HabitationDeckManager'); // Debug
            this.gameData = gameData;
            this.decks = {};
            this.initializeDecks();
        }

        // Initialise les decks pour chaque continent
        initializeDecks() {
            Object.keys(this.gameData.continents).forEach(continent => {
                console.log('Initialisation deck pour:', continent); // Debug
                this.decks[continent] = {
                    drawPile: [...this.gameData.continents[continent].habitations],
                    discardPile: [],
                    inPlay: []
                };
                this.shuffleDeck(continent);
            });
        }

        // Mélange le deck d'un continent
        shuffleDeck(continent) {
            const deck = this.decks[continent].drawPile;
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // Tire une carte pour un continent
        drawCard(continent) {
            const deck = this.decks[continent];

            // Si le deck est vide, on mélange la défausse
            if (deck.drawPile.length === 0) {
                deck.drawPile = [...deck.discardPile];
                deck.discardPile = [];
                this.shuffleDeck(continent);
            }

            if (deck.drawPile.length > 0) {
                const card = deck.drawPile.pop();
                deck.inPlay.push(card);
                return card;
            }

            return null;
        }

        // Défausse une carte
        discardCard(continent, cardIndex) {
            const deck = this.decks[continent];
            if (cardIndex >= 0 && cardIndex < deck.inPlay.length) {
                const card = deck.inPlay.splice(cardIndex, 1)[0];
                deck.discardPile.push(card);
                return card;
            }
            return null;
        }

        // Obtient les cartes en jeu pour un continent
        getCardsInPlay(continent) {
            return this.decks[continent].inPlay;
        }

        // Vérifie combien de cartes sont disponibles pour un continent
        getAvailableCardCount(continent) {
            return this.decks[continent].drawPile.length;
        }
    }

    // gameLogic.js

    // Classe principale pour gérer le jeu
    class EkokaoGame {
        constructor() {
            this.gameState = {
                currentMonth: 1,
                currentTurn: 1,
                timer: 180,
                isTimerRunning: false,
                habitationCards: {},
                history: [],
                continentStates: this.initializeContinentStates(),
                weatherEvents: []
            };

            this.weatherManager = new WeatherEventManager(gameData);
            this.habitationManager = new HabitationDeckManager(gameData);

            this.initializeEventListeners();
            this.updateDisplay();
        }

        // Fonction pour tirer une carte habitation
        drawHabitationCard() {
            const continent = this.gameState.activeContinent;
            console.log('Pioche pour le continent:', continent); // Debug

            const card = this.habitationManager.drawCard(continent);

            if (card) {
                console.log('Carte piochée:', card); // Debug
                // Ajouter la carte à l'état du jeu
                if (!this.gameState.habitationCards[continent]) {
                    this.gameState.habitationCards[continent] = [];
                }
                this.gameState.habitationCards[continent].push(card);

                this.addToHistory(`Nouvelle habitation tirée pour ${continent}: ${card.name}`);
                this.updateHabitationDisplay();
            } else {
                console.log('Pas de carte disponible'); // Debug
                this.addToHistory(`Plus de cartes disponibles pour ${continent}`);
            }
        }

        // Fonction pour mettre à jour l'affichage des cartes
        updateHabitationDisplay() {
            const container = document.getElementById('availableCards');
            if (!container) {
                console.error('Container availableCards non trouvé');
                return;
            }

            const continent = this.gameState.activeContinent;
            const cards = this.gameState.habitationCards[continent] || [];

            container.innerHTML = ''; // Nettoie le conteneur

            // Affiche le statut du deck
            const deckStatus = document.getElementById('deckStatus');
            if (deckStatus) {
                const remainingCards = this.habitationManager.getAvailableCardCount(continent);
                deckStatus.textContent = `Cartes restantes dans le deck: ${remainingCards}`;
            }

            // Affiche chaque carte
            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'game-card habitation-card';
                cardElement.innerHTML = `
            <div class="d-flex justify-content-between align-items-top">
                <h5 class="mb-2">${card.name}</h5>
                <span class="badge bg-primary">Résistance: ${card.resistance}</span>
            </div>
            <p class="mb-2">${card.description}</p>
            <div class="d-flex justify-content-end">
                <button class="btn btn-danger btn-sm" onclick="game.discardHabitation(${index})">
                    <i class="bi bi-trash"></i> Défausser
                </button>
            </div>
        `;
                container.appendChild(cardElement);
            });
        }

        // Fonction pour défausser une carte
        discardHabitation(index) {
            const continent = this.gameState.activeContinent;
            const discarded = this.habitationManager.discardCard(continent, index);

            if (discarded) {
                this.addToHistory(`Habitation défaussée: ${discarded.name}`);
                this.updateDisplay();
            }
        }

        // Initialisation des états des continents
        initializeContinentStates() {
            const continents = {};
            ['Europe', 'Afrique', 'Asie', 'Océanie', 'Amérique du Nord', 'Amérique du Sud'].forEach(continent => {
                continents[continent] = {
                    habitations: [],
                    protections: [],
                    activeEffects: [],
                    health: 100
                };
            });
            return continents;
        }

        // Gestion des événements
        initializeEventListeners() {
            // Existing timer controls
            document.getElementById('startTimer')?.addEventListener('click', () => this.startTimer());
            document.getElementById('pauseTimer')?.addEventListener('click', () => this.pauseTimer());
            document.getElementById('resetTimer')?.addEventListener('click', () => this.resetTimer());

            // Game controls
            document.getElementById('nextTurn')?.addEventListener('click', () => this.nextTurn());
            document.getElementById('saveGame')?.addEventListener('click', () => this.saveGame());
            document.getElementById('loadGame')?.addEventListener('click', () => this.loadGame());
            document.getElementById('drawHabitationBtn')?.addEventListener('click', () => this.drawHabitationCard());

            // Add continent button listeners
            const continentButtons = document.getElementById('continentButtons');
            if (continentButtons) {
                continentButtons.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', () => {
                        this.setActiveContinent(button.dataset.continent);
                    });
                });
            }
        }

        startTurn() {
            // Réinitialise le timer
            this.resetTimer();
            this.startTimer();

            // Génère les événements météo pour ce tour
            this.gameState.weatherEvents = this.weatherManager.generateWeatherEvents();

            // Affiche les nouveaux événements météo
            this.displayWeatherEvents();

            // Met à jour l'interface
            this.updateDisplay();
        }

        displayWeatherEvents() {
            const weatherContainer = document.getElementById('weatherCards');
            if (!weatherContainer) return;

            weatherContainer.innerHTML = '';

            this.gameState.weatherEvents.forEach(event => {
                const cardElement = document.createElement('div');
                cardElement.className = 'game-card weather-card mb-3';
                cardElement.innerHTML = `
                <div class="d-flex justify-content-between align-items-top">
                    <h5 class="mb-2">${event.event.name}</h5>
                    <span class="badge bg-danger">Puissance: ${event.power}</span>
                </div>
                <h6 class="mb-2">Continent: ${event.continent}</h6>
                <p class="mb-2">${event.event.description}</p>
            `;
                weatherContainer.appendChild(cardElement);
            });
        }

        // Gestion du timer
        startTimer() {
            if (!this.gameState.isTimerRunning) {
                this.gameState.isTimerRunning = true;
                this.timerInterval = setInterval(() => this.updateTimer(), 1000);
                document.getElementById('startTimer').disabled = true;
                document.getElementById('pauseTimer').disabled = false;
            }
        }

        pauseTimer() {
            if (this.gameState.isTimerRunning) {
                clearInterval(this.timerInterval);
                this.gameState.isTimerRunning = false;
                document.getElementById('startTimer').disabled = false;
                document.getElementById('pauseTimer').disabled = true;
            }
        }

        resetTimer() {
            clearInterval(this.timerInterval);
            this.gameState.isTimerRunning = false;
            this.gameState.timer = 180;
            this.updateTimerDisplay();
            document.getElementById('startTimer').disabled = false;
            document.getElementById('pauseTimer').disabled = false;
        }

        updateTimer() {
            if (this.gameState.timer > 0) {
                this.gameState.timer--;
                this.updateTimerDisplay();

                // Avertissement lorsqu'il reste peu de temps
                if (this.gameState.timer <= 30) {
                    document.getElementById('timer').classList.add('text-danger');
                }
            } else {
                this.pauseTimer();
            }
        }

        // Gestion des tours
        nextTurn() {
            if (this.gameState.currentTurn < 24) {
                this.gameState.currentTurn++;

                // Change de mois tous les 2 tours
                if (this.gameState.currentTurn % 2 === 1) {
                    this.gameState.currentMonth = Math.min(this.gameState.currentMonth + 1, 12);
                }

                // Démarre le nouveau tour
                this.startTurn();

                this.addToHistory(`Début du tour ${this.gameState.currentTurn} (Mois ${this.gameState.currentMonth})`);
            }
        }

        applyWeatherDamage() {
            this.gameState.weatherEvents.forEach(event => {
                const continent = event.continent;
                const continentState = this.gameState.continentStates[continent];

                if (continentState) {
                    // Calcule les dégâts en fonction de la puissance et des protections
                    const damage = this.calculateDamage(event.power, continentState.protections);

                    // Applique les dégâts
                    continentState.health = Math.max(0, continentState.health - damage);

                    this.addToHistory(`${event.event.name} cause ${damage} dégâts à ${continent}`);
                }
            });

            this.updateDisplay();
        }

        endTurn() {
            // Applique les dégâts météo
            this.applyWeatherDamage();

            // Passe au tour suivant
            this.nextTurn();
        }

        calculateDamage(power, protections) {
            // Base des dégâts est la puissance de l'événement
            let damage = power;

            // Réduit les dégâts en fonction des protections
            protections.forEach(protection => {
                damage = Math.max(0, damage - protection.effect);
            });

            return damage;
        }

        // Mise à jour du continent actif
        updateActiveContinent() {
            const continents = ['Europe', 'Afrique', 'Asie', 'Océanie', 'Amérique du Nord', 'Amérique du Sud'];
            const currentIndex = continents.indexOf(this.gameState.activeContinent);
            const nextIndex = (currentIndex + 1) % continents.length;
            this.gameState.activeContinent = continents[nextIndex];
        }

        // Gestion de l'historique
        addToHistory(event) {
            const timestamp = new Date().toLocaleTimeString();
            this.gameState.history.unshift(`[${timestamp}] ${event}`);
            this.updateHistoryDisplay();
        }

        // Sauvegarde et chargement
        saveGame() {
            const saveData = JSON.stringify(this.gameState);
            const blob = new Blob([saveData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ekokao_save_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            this.addToHistory('Partie sauvegardée');
        }

        loadGame() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        this.gameState = JSON.parse(event.target.result);
                        this.updateDisplay();
                        this.addToHistory('Partie chargée');
                    } catch (error) {
                        console.error('Erreur lors du chargement:', error);
                        alert('Erreur lors du chargement de la sauvegarde');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Mises à jour de l'affichage
        updateDisplay() {
            // Met à jour l'affichage du tour et du mois
            document.getElementById('currentMonth')?.textContent = `${this.gameState.currentMonth}/12`;
            document.getElementById('currentTurn')?.textContent = `${this.gameState.currentTurn}/24`;

            // Met à jour l'affichage des cartes météo
            this.displayWeatherEvents();

            // Met à jour l'affichage des habitations
            this.updateHabitationDisplay();

            // Met à jour l'historique
            this.updateHistoryDisplay();
        }

        updateTimerDisplay() {
            const minutes = Math.floor(this.gameState.timer / 60);
            const seconds = this.gameState.timer % 60;
            document.getElementById('timer').textContent =
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        updateGameStateDisplay() {
            document.getElementById('currentMonth').textContent = `${this.gameState.currentMonth}/12`;
            document.getElementById('currentTurn').textContent = `${this.gameState.currentTurn}/24`;
            document.getElementById('activeTeam').textContent =
                this.gameState.activeTeam === 'weather' ? 'Météo' : 'Habitat';
            document.getElementById('activeContinent').textContent = this.gameState.activeContinent;
        }

        updateContinentDisplay() {
            const continentStatus = document.getElementById('continentStatus');
            if (!continentStatus) {
                console.error('Element continentStatus not found');
                return;
            }

            continentStatus.innerHTML = '';

            Object.entries(this.gameState.continentStates).forEach(([continent, state]) => {
                const row = document.createElement('tr');
                if (continent === this.gameState.activeContinent) {
                    row.classList.add('table-active');
                }

                row.innerHTML = `
                <td>${continent}</td>
                <td>${state.habitations.length}</td>
                <td>${state.protections.length}</td>
                <td>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" 
                             style="width: ${state.health}%;"
                             aria-valuenow="${state.health}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            ${state.health}%
                        </div>
                    </div>
                </td>
                <td>
                    <button class="btn btn-sm btn-info" 
                            onclick="game.showContinentDetails('${continent}')">
                        Détails
                    </button>
                </td>
            `;
                continentStatus.appendChild(row);
            });
        }


        updateHistoryDisplay() {
            const historyList = document.getElementById('actionHistory');
            historyList.innerHTML = '';

            this.gameState.history.slice(0, 5).forEach(event => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.textContent = event;
                historyList.appendChild(li);
            });
        }

        // Affichage des détails d'un continent
        showContinentDetails(continent) {
            const modal = new bootstrap.Modal(document.getElementById('actionModal'));
            const modalBody = document.querySelector('#actionModal .modal-body');
            const state = this.gameState.continentStates[continent];

            modalBody.innerHTML = `
            <h6>Détails de ${continent}</h6>
            <div class="mb-3">
                <strong>Habitations:</strong>
                <ul>${state.habitations.map(h => `<li>${h}</li>`).join('')}</ul>
            </div>
            <div class="mb-3">
                <strong>Protections actives:</strong>
                <ul>${state.protections.map(p => `<li>${p}</li>`).join('')}</ul>
            </div>
            <div>
                <strong>Effets actifs:</strong>
                <ul>${state.activeEffects.map(e => `<li>${e}</li>`).join('')}</ul>
            </div>
        `;

            modal.show();
        }
    }

    // Weather
    class WeatherEventManager {
        constructor(gameData) {
            this.gameData = gameData;
            this.continents = Object.keys(gameData.continents);
        }

        generateWeatherEvents() {
            const events = [];

            // Sélectionne deux continents aléatoires différents
            const selectedContinents = this.selectRandomContinents(2);

            selectedContinents.forEach(continent => {
                const possibleEvents = this.gameData.continents[continent].catastrophes;
                const event = possibleEvents[Math.floor(Math.random() * possibleEvents.length)];

                events.push({
                    continent: continent,
                    event: event,
                    power: this.calculateEventPower(event)
                });
            });

            return events;
        }

        selectRandomContinents(count) {
            const shuffled = [...this.continents].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        calculateEventPower(event) {
            // Calcule la puissance en fonction du mois actuel et d'autres facteurs
            let power = event.basePower;
            // Augmente progressivement la puissance au fil des mois
            const monthModifier = Math.floor(game.gameState.currentMonth / 3);
            power = Math.min(event.maxPower, power + monthModifier);
            return power;
        }
    }

    // Initialisation du jeu
    const game = new EkokaoGame();

    // Rendre l'instance du jeu disponible globalement
    document.addEventListener('DOMContentLoaded', () => {
        window.game = new EkokaoGame();

    });
</script>